(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2080da"],{a2c6:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.apiMethods?n("div",{staticClass:"edit-container"},["update"==e.mode?[n("el-tabs",{staticClass:"edit-page-tabs",class:{"inline-tabs":e.inline},attrs:{type:e.inline?"":"border-card","tab-position":e.inline?"top":"right","before-leave":e.beforeLeave},on:{"tab-click":e.openInline},model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}},[e.isDisplayMainTab(e.formInfo.viewname)?n("el-tab-pane",{staticClass:"model-form-tab",attrs:{label:e.$t("main"),lazy:""}},[n("modelform",{attrs:{"form-info":e.formInfo,"api-info":e.apiInfo,settings:e.settings},on:{close:e.handleCloseCreateForm}})],1):e._e(),e._l(e.apiMethods,(function(t,i){return[t.inline_type?n("el-tab-pane",{key:t.name,attrs:{label:t.name,name:i,lazy:""}},[n("span",{attrs:{slot:"label"},slot:"label"},[t.icon?n("i",{class:t.icon}):e._e(),e._v(e._s(t.name))]),"table"===t.inline_type?n("inlinetable",{ref:"tab",refInFor:!0,attrs:{method:t,id:e.id,settings:e.settings}}):"graph"===t.inline_type?n("inlinegraph",{ref:"tab",refInFor:!0,attrs:{method:t,id:e.id,settings:e.settings}}):[e._v(" method: "+e._s(t)+" ")]],2):e._e()]})),e._l(e.sectionData.meta.related_inlines,(function(t){return n("el-tab-pane",{key:t.inline_slug,attrs:{name:t.inline_slug,lazy:""}},[n("span",{attrs:{slot:"label"},slot:"label"},[t.icon?n("i",{class:t.icon}):e._e(),e._v(" "+e._s(t.title))]),t.back_relation_name?n("list",{ref:"tab",refInFor:!0,attrs:{viewname:t.viewset_name,settings:e.settings,"api-info":e.apiInfo,"relation-name-filter":t.back_relation_name,filterId:e.id}}):n("edit",{ref:"tab",refInFor:!0,attrs:{settings:e.settings,viewname:t.viewset_name,"api-info":e.apiInfo,id:e.id,inline:!0,mode:"update"}})],1)}))],2)]:[n("modelform",{attrs:{"form-info":e.formInfo,"api-info":e.apiInfo,settings:e.settings},on:{close:e.handleCloseCreateForm}})]],2):e._e()},a=[],r=n("c7eb"),o=n("1da1"),s=(n("99af"),n("b0c0"),n("e9c4"),n("b64b"),n("d3b7"),n("ac1f"),n("3ca3"),n("5319"),n("ddb0"),n("ed08"),n("b681")),l=n("75c0"),c=n("6be2"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadData,expression:"loadData"}],staticClass:"inline-container"},[e.method.filterset_fields?n("filters",{attrs:{"filterset-fields":e.method.filterset_fields,"filter-info-init":e.filterInfo,settings:e.settings},on:{filtered:e.handleFilter}}):e._e(),e.inlineData&&e.inlineData.messages?e._l(e.inlineData.messages,(function(e){return n("el-alert",{key:e.title,attrs:{title:e.title,type:e.type}})})):e._e(),e.inlineData&&e.inlineData.data?[n("el-table",{attrs:{data:e.inlineData.data,stripe:"",border:"",fit:"","highlight-current-row":"",height:"calc(100vh - 260px)"}},e._l(e.inlineData.columns,(function(t){return n("el-table-column",{key:t,attrs:{prop:t,label:t,"min-width":170,width:e.getColumnInfo(t,"width"),fixed:e.getColumnInfo(t,"fixed")},scopedSlots:e._u([{key:"default",fn:function(i){return[e.getColumnInfo(t,"html")?[n("span",{domProps:{innerHTML:e._s(i.row[i.column.property])}})]:[e._v(" "+e._s(i.row[i.column.property])+" ")]]}}],null,!0)})})),1)]:e._e(),n("div",{staticClass:"below-list-section"},[Object.keys(e.method.actions).length>0?n("div",{staticClass:"actions-section"},[n("el-select",{staticClass:"action-selector",attrs:{placeholder:e.$t("select_action")},model:{value:e.selectedAction,callback:function(t){e.selectedAction=t},expression:"selectedAction"}},e._l(e.method.actions,(function(e,t){return n("el-option",{key:"action_"+t,attrs:{label:e.name,value:t}})})),1),n("el-button",{staticClass:"selection-button list-button run-action",attrs:{type:"primary"},on:{click:e.actionButton}},[e._v(e._s(e.$t("execute")))])],1):e._e(),n("div",{staticClass:"below-list-delimeter"}),n("pagination",{directives:[{name:"show",rawName:"v-show",value:e.count>0,expression:"count > 0"}],staticClass:"pagination",attrs:{total:e.count,page:e.pageInfo.page,limit:e.pageInfo.limit},on:{"update:page":function(t){return e.$set(e.pageInfo,"page",t)},"update:limit":function(t){return e.$set(e.pageInfo,"limit",t)},pagination:e.changePagination}})],1)],2)},u=[],f=(n("a15b"),n("841c"),n("5c96")),h=n("efd8"),p=n("e2a0c"),m=n("2bf4"),g=n("9218"),b={name:"InlineTable",props:{settings:{type:Object,required:!0},id:{type:String,required:!0},method:{type:Object,required:!0}},components:{Pagination:m["a"],Filters:p["a"]},data:function(){return{inlineData:null,loadData:!0,count:0,filterInfo:{search:null,filters:{}},defaultPageInfo:{page:1,limit:25},selectedAction:null}},created:function(){var e=this;return Object(o["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.pageInfo=JSON.parse(JSON.stringify(e.defaultPageInfo)),e.getInlineData();case 2:case"end":return t.stop()}}),t)})))()},methods:{getColumnInfo:function(e,t){if(this.inlineData){var n=this.inlineData.columns_info[e];return n?n[t]:void 0}},columnWidth:function(e){if(this.inlineData){var t=this.inlineData.columns_info[e];return t?t["width"]:void 0}},changePagination:function(){this.getInlineData()},handleFilter:function(e){this.filterInfo=e,this.count=0,this.pageInfo=JSON.parse(JSON.stringify(this.defaultPageInfo)),this.getInlineData()},getInlineData:function(){var e=this;this.loadData=!0,this.inlineData=null,this.errors=null;var t=this.method.url.replace("{id}",this.id);Object(h["a"])({url:t,method:this.method.methodHttp,pageInfo:this.pageInfo,filters:this.filterInfo.filters,search:this.filterInfo.search}).then((function(t){e.inlineData=t,e.count=e.inlineData.count,e.loadData=!1})).catch((function(n){e.loadData=!1,console.error("Get inline data error from ".concat(t,":")+n,e.pageInfo),Object(f["Message"])({message:n,type:"error",duration:5e3})}))},sendAction:function(){var e=this;this.loadData=!0,this.inlineData=null;var t=this.method.url.replace("{id}",this.id);Object(h["a"])({url:t,method:this.method.methodHttp,pageInfo:this.pageInfo,filters:this.filterInfo.filters,search:this.filterInfo.search,inline_action:this.selectedAction}).then((function(t){if("text/csv"===t.headers["content-type"]){var n=t.headers["pragma"]||"".concat(moment().format("DD.MM.YYYY_HH:MM"),".csv");Object(g["a"])(t.data,n,t.headers["content-type"])}else t.data.action_messages&&Object(f["Message"])({message:t.data.action_messages.join("<br>"),type:"success",duration:5e3,dangerouslyUseHTMLString:!0});e.getInlineData()})).catch((function(n){e.loadData=!1,console.error("Get inline data error from ".concat(t,":")+n,e.pageInfo),Object(f["Message"])({message:n,type:"error",duration:5e3})}))},actionButton:function(){this.loadData||(this.selectedAction?this.sendAction():Object(f["Message"])({message:this.$t("no_action"),type:"info",duration:5e3}))}}},v=b,y=n("2877"),I=Object(y["a"])(v,d,u,!1,null,null,null),_=I.exports,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadData,expression:"loadData"}],staticClass:"inline-container"},[e.method.filterset_fields?n("filters",{attrs:{"filterset-fields":e.method.filterset_fields,"filter-info-init":e.filterInfo,settings:e.settings},on:{filtered:e.handleFilter}}):e._e(),e.responseData&&e.responseData.messages?e._l(e.responseData.messages,(function(e){return n("el-alert",{key:e.title,attrs:{title:e.title,type:e.type}})})):e._e(),e.responseData?n("div",[e._l(e.responseData.charts,(function(t){return[n(e.getComponent(t),{tag:"component",attrs:{"chart-options":t.options,"chart-data":t,width:t.options.width,height:t.options.height,fill:t.fill,pointBorderColor:t.pointBorderColor,borderColor:t.borderColor,backgroundColor:t.backgroundColor,pointBorderWidth:t.pointBorderWidth,tension:t.tension,borderWidth:t.borderWidth}})]}))],2):e._e()],2)},w=[],O=n("7b971"),j=n("dd61");j["e"].register(j["q"],j["r"],j["h"],j["j"],j["k"],j["d"],j["m"],j["g"],j["b"]);var C={name:"inline-graph",components:{Filters:p["a"]},props:{settings:{type:Object,required:!0},id:{type:String,required:!0},method:{type:Object,required:!0}},data:function(){return{loadData:!0,responseData:null,filterInfo:{search:null,filters:{}},types:{line:O["d"],bar:O["a"],bubble:O["b"],doughnut:O["c"],pie:O["e"],polararea:O["f"],radar:O["g"],scatter:O["h"]}}},created:function(){var e=this;return Object(o["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.getInlineData();case 1:case"end":return t.stop()}}),t)})))()},methods:{getComponent:function(e){var t=this.types[e.type];if(t)return t;Object(f["Message"])({message:'Inline type "'.concat(e.type,'" not found'),type:"error",duration:5e3})},handleFilter:function(e){this.filterInfo=e,this.getInlineData()},getInlineData:function(){var e=this;this.loadData=!0,this.chartData=null;var t=this.method.url.replace("{id}",this.id);Object(h["a"])({url:t,method:this.method.methodHttp,filters:this.filterInfo.filters,search:this.filterInfo.search}).then((function(t){e.responseData=t,e.loadData=!1})).catch((function(n){e.loadData=!1,console.error("Get inline data error from ".concat(t,":")+n,e.pageInfo),Object(f["Message"])({message:n,type:"error",duration:5e3})}))}}},k=C,M=Object(y["a"])(k,D,w,!1,null,null,null),T=M.exports,q={name:"ComplexTable",components:{modelform:s["default"],list:c["default"],edit:function(){return Promise.resolve().then(n.bind(null,"a2c6"))},inlinetable:_,inlinegraph:T},props:{apiInfo:{type:Object,required:!0},settings:{type:Object,required:!0},group:{type:String,required:!1},viewname:{type:String,required:!1},id:{type:String,required:!1},inline:{type:Boolean,required:!1},mode:{type:String,required:!1}},data:function(){return{currentTab:null,formInfo:{formType:this.mode,recordId:this.id,viewname:this.viewname,showTitle:!1,apiMethods:null},apiMethods:null,sectionData:null}},created:function(){var e=this;return Object(o["a"])(Object(r["a"])().mark((function t(){var n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.apiMethods=Object(l["b"])(e.formInfo.viewname,e.apiInfo),e.apiMethods||console.error('getMethods return null for viewname:"'.concat(e.formInfo.viewname,'"')),e.sectionData=e.apiInfo[e.formInfo.viewname],e.deserializeQuery(),e.isDisplayMainTab()||null!=e.currentTab||(n=Object.keys(e.apiMethods)[0],e.currentTab=n);case 5:case"end":return t.stop()}}),t)})))()},methods:{beforeLeave:function(e,t){this.currentTab=null},isDisplayMainTab:function(){return this.sectionData&&this.sectionData.meta&&this.sectionData.meta.filds_list},deserializeQuery:function(){var e=this.inline?this.$route.query.inlineTab:this.$route.query.tab;e&&(this.currentTab=e)},serializeQuery:function(){var e=JSON.parse(JSON.stringify(this.$route.query));delete e.inlineTab,this.currentTab&&(this.inline?e.inlineTab=this.currentTab:e.tab=this.currentTab),this.$router.replace({name:this.$route.name,query:e})},openInline:function(e,t){this.serializeQuery()},handleCloseCreateForm:function(e){if(window.history.length>2)this.$router.go(-1);else{var t="".concat(this.group,"/").concat(this.viewname,"/list");this.$router.push({path:t,query:this.$route.query})}}}},x=q,$=Object(y["a"])(x,i,a,!1,null,null,null);t["default"]=$.exports}}]);